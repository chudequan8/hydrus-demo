(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1587b89c"],{"1c4c":function(e,t,r){"use strict";var n=r("9b43"),i=r("5ca1"),o=r("4bf8"),a=r("1fa8"),l=r("33a4"),s=r("9def"),c=r("f1ae"),u=r("27ee");i(i.S+i.F*!r("5cc5")((function(e){Array.from(e)})),"Array",{from:function(e){var t,r,i,d,p=o(e),h="function"==typeof this?this:Array,f=arguments.length,m=f>1?arguments[1]:void 0,g=void 0!==m,v=0,y=u(p);if(g&&(m=n(m,f>2?arguments[2]:void 0,2)),void 0==y||h==Array&&l(y))for(t=s(p.length),r=new h(t);t>v;v++)c(r,v,g?m(p[v],v):p[v]);else for(d=y.call(p),r=new h;!(i=d.next()).done;v++)c(r,v,g?a(d,m,[i.value,v],!0):i.value);return r.length=v,r}})},"58d3":function(e,t,r){},"713b":function(e,t,r){},"86f2":function(e,t,r){"use strict";var n=r("58d3"),i=r.n(n);i.a},b022:function(e,t,r){"use strict";var n=r("713b"),i=r.n(n);i.a},e1ca:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"model-table-pagenation"},[r("div",{staticClass:"model-table"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading.lock",value:e.loading,expression:"loading",modifiers:{lock:!0}}],ref:"gridUnit",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:e.border,stripe:e.stripe,"max-height":e.tableHeight,fit:e.fit,size:e.size,"show-header":e.showHeader,"highlight-current-row":e.highlightCurrentRow,"current-row-key":e.currentRowKey,"row-class-name":e.rowClassName,"row-style":e.rowStyle,"row-ket":e.rowKey,"empty-text":e.emptyText,"default-expand-all":e.defaultExpandAll,"expand-row-keys":e.expandRowKeys,"default-sort":e.defaultSort,"tooltip-effect":e.tooltipEffect,"show-summary":e.showSummary,"sum-text":e.sumText,"summary-method":e.summaryMethod,"cell-class-name":e.cellClassName,"span-method":e.spanMethod,"header-row-style":e.headerRowStyle,"header-cell-style":e.headerCellStyle,"cell-style":e.cellStyle,footerScopedSlots:e.footerScopedSlots},on:{select:function(t,r){return e.emitEventHandler("select",t,r)},"select-all":function(t){return e.emitEventHandler("select-all",t)},"selection-change":function(t){return e.emitEventHandler("selection-change",t)},"cell-mouse-enter":function(t,r,n,i){return e.emitEventHandler("cell-mouse-enter",t,r,n,i)},"cell-mouse-leave":function(t,r,n,i){return e.emitEventHandler("cell-mouse-leave",t,r,n,i)},"cell-click":function(t,r,n,i){return e.emitEventHandler("cell-click",t,r,n,i)},"cell-dblclick":function(t,r,n,i){return e.emitEventHandler("cell-dblclick",t,r,n,i)},"row-click":function(t,r,n){return e.emitEventHandler("row-click",t,r,n)},"row-dblclick":function(t,r){return e.emitEventHandler("row-dblclick",t,r)},"row-contextmenu":function(t,r){return e.emitEventHandler("row-contextmenu",t,r)},"header-click":function(t,r){return e.emitEventHandler("header-click",t,r)},"sort-change":function(t){return e.emitEventHandler("sort-change",t)},"filter-change":function(t){return e.emitEventHandler("filter-change",t)},"current-change":function(t,r){return e.emitEventHandler("current-change",t,r)},"header-dragend":function(t,r,n,i){return e.emitEventHandler("header-dragend",t,r,n,i)},"expand-change":function(t,r){return e.emitEventHandler("expand-change",t,r)}}},[e.showRowIndex?r("el-table-column",{attrs:{type:"index",width:"40",align:"center"}}):e._e(),e.showExpand?r("el-table-column",{attrs:{type:"expand",width:"40"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("expandTable",null,{row:t.row}),e._t("expandForm",null,{row:t.row})]}}],null,!0)}):e._e(),e._l(e.columns,(function(t,n){return[t.slot&&e.showSelection?e._t(t.slot):e._e(),t.slot?e._e():r("el-table-column",{key:n,attrs:{"column-key":t.columnKey,prop:t.prop,label:t.label,width:t.minWidth?"-":t.width||"auto","min-width":t.minWidth||t.width||100,fixed:t.fixed,"render-header":t.renderHeader,sortable:t.sortable,"sort-method":t.method,resizable:t.resizable,formatter:t.formatter,"show-overflow-tooltip":t.showOverflowTooltip||!0,align:t.align||"left","header-align":t.headerAlign||t.align,"class-name":t.className,"label-class-name":t.labelClassName,selectable:t.selectable,"reserve-selection":t.reserveSelection,filters:t.filters,"filter-placement":t.filterPlacement,"filter-multiple":t.filterMultiple,"filter-method":t.filterMethod,"filtered-value":t.filteredValue},scopedSlots:e._u([{key:"default",fn:function(n){return[t.filter?r("span",["parseTime"===t.filter&&n.row[t.prop]&&""!=n.row[t.prop]?r("i",{staticClass:"el-icon-time"}):e._e(),e._v("\n              "+e._s(e.Vue.filter(t["filter"])(n.row[t.prop]))+"\n            ")]):"img"===t.type?r("div",{staticStyle:{display:"flex"}},[r("img",{directives:[{name:"lazy",rawName:"v-lazy",value:n.row[t.prop],expression:"scope.row[column.prop]"}],staticClass:"image preview-img image-center",attrs:{width:"40",height:"40"},on:{click:function(r){return e.previewImage(n.row[t.prop])}}})]):"link"===t.type?r("a",{staticStyle:{color:"#409eff"},attrs:{href:n.row[t.prop],target:"_blank"}},[e._v("\n              "+e._s(n.row[t.prop])+"\n            ")]):"status"===t.type&&t.unitFilters?r("el-tag",{attrs:{type:t.unitFilters.renderStatusType(n.row[t.prop])}},[e._v("\n              "+e._s(t.unitFilters.renderStatusValue(n.row[t.prop]))+"\n            ")]):t.slotName?r("span",[e._t(t.slotName,null,{row:n.row,$index:n.$index})],2):t.isHandle?r("span",[r("el-button",{attrs:{icon:t.icon,type:"primary",size:"small"}},[e._v(e._s(t.text))])],1):r("span",[e._v("\n              "+e._s(t.render?t.render(n.row):n.row[t.prop])+"\n            ")])]}}],null,!0)})]}))],2)],1),e.showPagination?r("div",{ref:"gridPagination",staticClass:"model-pagenation"},[r("el-pagination",{attrs:{background:e.pagenationBg,"current-page":e.pagination.pageNo,"page-sizes":e.pageSizes,"page-size":e.pagination.pageSize,layout:e.paginationLayout,total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()])},i=[],o=(r("6762"),r("5df3"),r("1c4c"),r("75fc")),a=r("7618"),l=(r("6b54"),r("28a5"),r("ac6a"),r("bd86")),s=r("2b0e"),c=(r("c5f6"),{maxHeight:[String,Number],stripe:{type:Boolean,default:!0},border:{type:Boolean,default:!0},size:{type:String,default:"medium"},fit:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!0},highlightCurrentRow:{type:Boolean,default:!0},currentRowKey:[String,Number],rowClassName:[String,Function],rowStyle:[String,Function],rowKey:[String,Function],emptyText:String,defaultExpandAll:Boolean,expandRowKeys:Array,defaultSort:Object,tooltipEffect:String,showSummary:Boolean,sumText:String,summaryMethod:Function,cellClassName:[String,Function],headerRowStyle:[Function],headerCellStyle:[Function],cellStyle:[Function],footerScopedSlots:[Object],reqMethod:Function,selectionKey:{type:String,default:"id"},headers:{type:Object,default:function(){return{}}},showRowIndex:{type:Boolean,default:!1},showSelection:{type:Boolean,default:!1},showExpand:{type:Boolean,default:!1},listField:{type:String,default:"rows"},totalField:{type:String,default:"total"},params:{type:Object,default:function(){return{}}},formOptions:{type:Object,default:function(){return{}}},autoLoad:{type:Boolean,default:!0},spanMethod:{type:Function},indexMethod:{type:Function},type:{type:String,default:"remote",validator:function(e){var t=["remote","local"],r=-1!==t.indexOf(e);return r||!1}},data:{type:Array},dataHandler:{type:Function},columns:{type:Array,required:!0,columnKey:String,label:{type:String,required:!0},prop:{type:String,required:!0},width:{type:[Number,String],default:"auto"},minWidth:{type:Number,default:100},fixed:[Boolean,String],renderHeader:Function,sortable:[Boolean,String],sortMethod:Function,resizable:Boolean,formatter:Function,showOverflowTooltip:{type:Boolean,default:!0},align:{type:String,default:"left"},headerAlign:String,className:{type:String,default:""},labelClassName:{type:String,default:""},selectable:Function,reserveSelection:Boolean,filters:Array,filterPlacement:String,filterMultiple:{type:Boolean,default:!0},filterMethod:Function,filteredValue:Array,filter:{type:String},render:{type:Function},slotName:{type:String}},expandColums:{type:Array,default:function(){return[]}},showPagination:{type:Boolean,default:!0},pagenationBg:{type:Boolean,default:!0},pageSize:{type:Number,default:10},pageSizes:{type:Array,default:function(){return[10,20,50,100]}},paginationLayout:{type:String,default:"total, sizes, prev, pager, next, jumper"},pageNoKey:{type:String,default:"page"},pageSizeKey:{type:String,default:"size"}}),u=c,d=r("ed08"),p=r("0e15"),h=r.n(p),f=0,m=0,g=15,v=20,y=15,b={name:"tablePagination",props:u,data:function(){return{Vue:s["default"],pagination:{pageNo:1,pageSize:this.pageSizes?this.pageSizes[0]:20},total:0,loading:!1,tableData:[],searchParams:{},multipleSelection:[],multipleSelectionAll:[],tableHeight:600}},computed:{},watch:{formOptions:{immediate:!0,handler:function(e){this.searchParams=Object.assign(e,this.params)},deep:!0},params:{handler:function(e){this.searchParams=Object.assign(e,this.params)},deep:!0}},mounted:function(){var e=this;this.$refs.gridUnit.$on("expand-change",(function(t,r){return e.emitEventHandler("expand-change",t,r)}));var t=this.type,r=this.autoLoad,n=this.formOptions,i=this.params,o=this.data;"remote"===t&&r?(this.searchParams=n?Object.assign(n,i):i,this.fetchHandler()):"local"===t&&Array.isArray(o)&&(this.tableData=o,this.total=o.length),this.$nextTick((function(){g=document.querySelectorAll(".el-tabs")[0]?15:0,e.changeTableSize(),window.addEventListener("resize",e.changeTableSize)}))},beforeDestroy:function(){window.removeEventListener("resize",this.changeTableSize)},methods:{previewImage:function(e){if(!e)return!1;var t={src:e},r=new Image;r.src=e,r.onload=function(){t.w=r.width||800,t.h=r.height||600,s["default"].$preview.open(0,[t])}},handleSizeChange:function(e){this.pagination.pageSize=e,this.fetchHandler("selection")},handleCurrentChange:function(e){this.pagination.pageNo=e,this.changePageHoldSelection(),this.fetchHandler("selection")},searchHandler:function(e){this.pagination.pageNo=1,e&&"clear"===e.type&&(this.searchParams=e.data),this.fetchHandler()},fetchHandler:function(e,t){var r,n,i=this,o=this.reqMethod,s=this.listField,c=this.pageNoKey,u=this.pageSizeKey,p=this.totalField,h=this.showPagination,f=this.pagination;if("function"!==typeof o)return this.$message.error("请传入请求方法"),!1;(this.loading=!t,r=Object(d["a"])(Object(d["d"])(this.searchParams)),h)&&(r=Object.assign(r,(n={},Object(l["a"])(n,c,"offset"===c?(f.pageNo-1)*f.pageSize:f.pageNo),Object(l["a"])(n,u,f.pageSize),n)));o(r).then((function(t){var r=t,n=r;if(!r||r instanceof Array||(s&&-1!==s.indexOf(".")?s.split(".").forEach((function(e){n=n[e]})):n=r[s]||[]),!n||!(n instanceof Array))return i.loading=!1,!1;i.dataHandler?i.tableData=i.dataHandler(n):i.tableData=n;var o=r;"[object Array]"===Object.prototype.toString.call(r)?o=r.length:"object"===Object(a["a"])(r)?p&&-1!==p.indexOf(".")?p.split(".").forEach((function(e){o=o[e]})):o=r[p]||0:o=0,i.total=o,i.loading=!1,"selection"===e?setTimeout((function(){i.setSelectRow()}),0):(i.multipleSelection=[],i.multipleSelectionAll=[])})).catch((function(e){i.$message.error(e.msg||"请求失败"),i.loading=!1}))},emitEventHandler:function(e){var t=this,r=arguments;"selection-change"===e?(this.multipleSelection=Object(o["a"])(Array.from(arguments).slice(1))[0],setTimeout((function(){t.changePageHoldSelection(),t.$emit.apply(t,[e].concat(Object(o["a"])(Array.from(r).slice(1))))}),0)):this.$emit.apply(this,[e].concat(Object(o["a"])(Array.from(arguments).slice(1))))},setSelectRow:function(){if(this.multipleSelectionAll&&!(this.multipleSelectionAll.length<=0)){var e=this.selectionKey,t=[];this.multipleSelectionAll.forEach((function(r){t.push(r[e])})),this.$refs.gridUnit.clearSelection();for(var r=0;r<this.tableData.length;r++)t.includes(this.tableData[r][e])&&this.$refs.gridUnit.toggleRowSelection(this.tableData[r],!0)}},changePageHoldSelection:function(){var e=this,t=this.selectionKey;if(this.multipleSelectionAll.length<=0)this.multipleSelectionAll=this.multipleSelection;else{var r=[];this.multipleSelectionAll.forEach((function(e){r.push(e[t])}));var n=[];this.multipleSelection.forEach((function(i){n.push(i[t]),r.includes(i[t])||e.multipleSelectionAll.push(i)}));var i=[];this.tableData.forEach((function(e){n.includes(e[t])||i.push(e[t])})),i.forEach((function(n){if(r.includes(n))for(var i=0;i<e.multipleSelectionAll.length;i++)if(e.multipleSelectionAll[i][t]===n){e.multipleSelectionAll.splice(i,1);break}}))}},changeTableSize:h()(100,(function(){f=this.$refs.gridUnit.$el.getBoundingClientRect().top,m=this.$refs.gridPagination.offsetHeight;var e=document.body.clientHeight-f-m-g-v-y;this.tableHeight=Math.max(e,250)}))}},w=b,S=(r("b022"),r("2877")),x=Object(S["a"])(w,n,i,!1,null,"2580dfa0",null);t["a"]=x.exports},f1ba:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"handle-options"},[r("el-button",{staticClass:"back-button",attrs:{plain:"",icon:"el-icon-arrow-left",size:"small"},on:{click:e.backToProductManager}},[e._v("返回")]),r("el-button",{attrs:{type:"success",size:"small",plain:"",icon:"el-icon-plus"},on:{click:e.handleAddVersion}},[e._v("新增")])],1),r("grid-unit",{ref:"versionGrid",attrs:{formOptions:e.formOptions,reqMethod:e.$api.productManager.getProductVersionList,autoLoad:!1,columns:e.colModels},scopedSlots:e._u([{key:"versionStatus",fn:function(t){return[r("toggle-button",{attrs:{sync:!0,value:1===t.row.status,labels:{checked:"开",unchecked:"关"},color:"#67C23A"},nativeOn:{click:function(r){return e.toggleSwitch(t.row,r)}}})]}},{key:"handle",fn:function(t){return[r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(r){return e.handleEditVersion(t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(r){return e.handleDeleteVersion(t.row)}}},[e._v("删除")])]}}])}),r("el-dialog",{attrs:{title:-1===e.curVersionId?"新增版本":"编辑版本",visible:e.versionDialogVisible,"append-to-body":"",width:"400px"},on:{"update:visible":function(t){e.versionDialogVisible=t},closed:e.handleDialogClosed}},[r("el-form",{ref:"versionForm",staticClass:"versionForm",attrs:{model:e.versionForm,rules:e.versionFormRules,"label-width":"90px"}},[r("el-form-item",{attrs:{label:"产品代号",prop:"productCode"}},[r("el-input",{attrs:{disabled:""},model:{value:e.versionForm.productCode,callback:function(t){e.$set(e.versionForm,"productCode",t)},expression:"versionForm.productCode"}})],1),r("el-form-item",{attrs:{label:"版本",prop:"version"}},[r("el-input",{model:{value:e.versionForm.version,callback:function(t){e.$set(e.versionForm,"version",t)},expression:"versionForm.version"}})],1),r("el-form-item",{attrs:{label:"评分卡",prop:"scorecard"}},[r("el-select",{staticStyle:{width:"100%"},model:{value:e.versionForm.scorecard,callback:function(t){e.$set(e.versionForm,"scorecard",t)},expression:"versionForm.scorecard"}},e._l(e.scoreCardList,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:"规则组",prop:"ruleGroup"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:""},model:{value:e.versionForm.ruleGroup,callback:function(t){e.$set(e.versionForm,"ruleGroup",t)},expression:"versionForm.ruleGroup"}},e._l(e.ruleGroupList,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.versionDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveVersion}},[e._v("确 定")])],1)],1)],1)},i=[],o=(r("28a5"),r("e1ca")),a=r("ed08"),l={name:"versionManager",props:{visible:{type:Boolean,default:!1},productCode:{type:String,default:"-1"}},components:{GridUnit:o["a"]},data:function(){return{colModels:[{prop:"productCode",label:"产品代号"},{prop:"ruleGroup",label:"规则组"},{prop:"scorecard",label:"评分卡"},{prop:"version",label:"版本"},{label:"状态",slotName:"versionStatus"},{prop:"crtTime",label:"创建时间"},{prop:"updTime",label:"更新时间"},{label:"操作",slotName:"handle",fixed:"right",width:150}],formOptions:{productCode:""},ruleGroupList:[],scoreCardList:[],versionDialogVisible:!1,versionForm:{productCode:"",scorecard:"",version:"",ruleGroup:[],status:1},versionFormRules:{productCode:[{required:!0,message:"产品代号不能为空",trigger:"blur"}],scorecard:[{required:!0,message:"评分卡不能为空",trigger:"blur"}],version:[{required:!0,message:"版本不能为空",trigger:"blur"}],ruleGroup:[{required:!0,message:"规则组不能为空",trigger:"blur"}]},curVersionId:-1}},watch:{visible:function(e){var t=this;e&&(this.formOptions.productCode=this.productCode,this.versionForm.productCode=this.productCode,this.$nextTick((function(){t.searchParams(),t.handleRuleGroupList(),t.handleScoreCardList()})))}},methods:{handleAddVersion:function(){this.versionDialogVisible=!0},handleEditVersion:function(e){var t=e.version,r=e.productCode,n=e.ruleGroup,i=e.status,o=e.scorecard,a=e.id;this.curVersionId=a,this.$set(this,"versionForm",{version:t,productCode:r,ruleGroup:n.split(","),status:i,scorecard:o}),this.versionDialogVisible=!0},handleDeleteVersion:function(e){var t=this;this.$confirm("确定删除此版本吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$api.productManager.deleteVersion(e.id).then((function(e){t.$message({type:e.rel?"success":"error",message:e.message||(e.rel?"删除成功":"删除失败")}),e.rel&&t.searchParams()}))})).catch((function(){return!1}))},searchParams:function(){this.$refs.versionGrid.searchHandler()},backToProductManager:function(){this.$emit("update:visible",!1),this.$emit("update:productCode","-1")},handleRuleGroupList:function(){var e=this;this.$api.productManager.getRuleGroupList().then((function(t){e.ruleGroupList=t||[]}))},handleScoreCardList:function(){var e=this;this.$api.productManager.getScoreCardList().then((function(t){e.scoreCardList=t||[]}))},handleSaveVersion:function(){var e=this;this.$refs.versionForm.validate((function(t){if(t){var r=-1===e.curVersionId,n=e.$api.productManager[r?"addVersion":"editVersion"],i=Object(a["d"])(e.versionForm);i.ruleGroup=i.ruleGroup.join(","),n(i,r?void 0:e.curVersionId).then((function(t){t.rel?(e.$message({type:"success",message:"".concat(r?"新增":"编辑","版本成功")}),e.versionDialogVisible=!1,e.searchParams()):e.$message({type:"error",message:t.message||"".concat(r?"新增":"编辑","版本失败")})}))}}))},handleDialogClosed:function(){this.curVersionId=-1,this.$refs.versionForm.clearValidate(),this.$set(this,"versionForm",{productCode:this.productCode,scorecard:"",version:"",ruleGroup:[],status:1})},toggleSwitch:function(e,t){var r=this;t.preventDefault();var n=Object(a["d"])(e);n.status=1===n.status?0:1,this.$api.productManager.editVersion(n,e.id).then((function(t){t.rel?(r.$message({type:"success",message:"状态切换成功"}),e.status=1===e.status?0:1):r.$message({type:"error",message:"状态切换失败"})}))}}},s=l,c=(r("86f2"),r("2877")),u=Object(c["a"])(s,n,i,!1,null,"7ea366c6",null);t["default"]=u.exports}}]);