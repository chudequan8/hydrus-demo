(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ebdc8cac"],{"45f4":function(e,t,r){},"58d3":function(e,t,r){},"65cf":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-card",{staticClass:"product-card"},[r("div",{staticClass:"product-card-body"},[r("el-row",{staticClass:"product-card-body-row",class:[e.versionVisible?"show-version":""]},[r("el-col",{staticClass:"product-table",attrs:{span:12}},[r("div",{staticClass:"handle-options"},[r("el-button",{attrs:{type:"success",size:"small",plain:"",icon:"el-icon-plus"},on:{click:e.handleAddProduct}},[e._v("新增")])],1),r("grid-unit",{ref:"productGrid",attrs:{reqMethod:e.$api.productManager.getProductList,columns:e.colModels},scopedSlots:e._u([{key:"productStatus",fn:function(t){return[r("toggle-button",{attrs:{sync:!0,value:1===t.row.status,labels:{checked:"开",unchecked:"关"},color:"#67C23A"},nativeOn:{click:function(r){return e.toggleSwitch(t.row,r)}}})]}},{key:"handle",fn:function(t){return[2===t.row.type&&t.row.argument?r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(r){return e.handleEditProduct(t.row)}}},[e._v("编辑")]):e._e(),r("el-button",{attrs:{size:"small",type:"success"},on:{click:function(r){return e.handleVersionManager(t.row.productCode)}}},[e._v("版本管理")]),2===t.row.type?r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(r){return e.handleThirdConfig(t.row.productCode)}}},[e._v("配置")]):e._e()]}}])})],1),r("el-col",{staticClass:"version-table",attrs:{span:12}},[r("version-manager",{attrs:{visible:e.versionVisible,productCode:e.curProductCode},on:{"update:visible":function(t){e.versionVisible=t},"update:productCode":function(t){e.curProductCode=t},"update:product-code":function(t){e.curProductCode=t}}})],1)],1)],1)]),r("el-dialog",{attrs:{title:"第三方配置",visible:e.configDialogVisible,width:"400px"},on:{"update:visible":function(t){e.configDialogVisible=t},closed:function(t){return e.handleDialogClosed(2)}}},[r("el-checkbox-group",{staticClass:"third-config-checkbox",model:{value:e.checkedConfig,callback:function(t){e.checkedConfig=t},expression:"checkedConfig"}},e._l(e.configList,(function(t){return r("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.description))])})),1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.configDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveConfig}},[e._v("确 定")])],1)],1),r("Drawer",{ref:"productDrawer",attrs:{visible:e.drawerVisible,title:-1===e.curProductId?"新建产品":"编辑产品",width:"600px",beforeClose:e.checkDrawerClose},on:{"update:visible":function(t){e.drawerVisible=t},closed:function(t){return e.handleDialogClosed(1)}},scopedSlots:e._u([{key:"footer",fn:function(t){var o=t.handleClose;return[r("span",{staticClass:"dialog-footer"},[r("el-button",{on:{click:o}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveProduct}},[e._v("确 定")])],1)]}}])},[r("el-form",{ref:"productForm",staticClass:"productForm",attrs:{model:e.productForm,rules:e.productFormRules,"label-width":"90px"}},[r("el-form-item",{attrs:{label:"产品名称",prop:"productName"}},[r("el-input",{model:{value:e.productForm.productName,callback:function(t){e.$set(e.productForm,"productName",t)},expression:"productForm.productName"}})],1),r("el-form-item",{attrs:{label:"产品代号",prop:"productCode"}},[r("el-input",{model:{value:e.productForm.productCode,callback:function(t){e.$set(e.productForm,"productCode",t)},expression:"productForm.productCode"}})],1),r("el-form-item",{attrs:{label:"产品方法",prop:"productMethod"}},[r("el-select",{attrs:{multiple:""},model:{value:e.productForm.productMethod,callback:function(t){e.$set(e.productForm,"productMethod",t)},expression:"productForm.productMethod"}},e._l(e.methodsList,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:"收费方法",prop:"chargesMethod"}},[r("el-select",{model:{value:e.productForm.chargesMethod,callback:function(t){e.$set(e.productForm,"chargesMethod",t)},expression:"productForm.chargesMethod"}},e._l(e.methodsList,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:"版本",prop:"version"}},[r("el-input",{model:{value:e.productForm.version,callback:function(t){e.$set(e.productForm,"version",t)},expression:"productForm.version"}})],1),r("el-form-item",{attrs:{label:"类型",prop:"type"}},[r("el-select",{model:{value:e.productForm.type,callback:function(t){e.$set(e.productForm,"type",t)},expression:"productForm.type"}},e._l(e.typeList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"价格",prop:"price"}},[r("el-input",{model:{value:e.productForm.price,callback:function(t){e.$set(e.productForm,"price",e._n(t))},expression:"productForm.price"}})],1),r("el-form-item",{attrs:{label:"排序号",prop:"orderNum"}},[r("el-input",{model:{value:e.productForm.orderNum,callback:function(t){e.$set(e.productForm,"orderNum",t)},expression:"productForm.orderNum"}})],1),r("el-form-item",{attrs:{label:"参数",prop:"argument"}},[r("el-select",{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"手动输入创建"},model:{value:e.productForm.argument,callback:function(t){e.$set(e.productForm,"argument",t)},expression:"productForm.argument"}},e._l([],(function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1)],1)},s=[],i=(r("28a5"),r("e1ca")),a=r("ca50"),n=r("f1ba"),c=r("ed08"),l={},u={name:"productManager",components:{GridUnit:i["a"],Drawer:a["a"],VersionManager:n["default"]},data:function(){return{colModels:[{prop:"productName",label:"产品名称"},{prop:"productCode",label:"产品代号"},{prop:"productMethod",label:"产品方法"},{prop:"chargesMethod",label:"收费方法"},{prop:"argument",label:"参数"},{prop:"version",label:"版本"},{prop:"type",label:"类型",render:function(e){return 1===e.type?"快捷产品":"联合建模产品"}},{prop:"price",label:"价格"},{label:"状态",slotName:"productStatus"},{prop:"crtTime",label:"更新时间"},{label:"操作",slotName:"handle",fixed:"right",width:240}],configDialogVisible:!1,curProductId:-1,curProductCode:"-1",productForm:{productName:"",productCode:"",productMethod:[],chargesMethod:"",version:"",type:"",price:"",status:1,orderNum:"",argument:[]},productFormRules:{productName:[{required:!0,message:"产品名称不能为空",trigger:"blur"}],productCode:[{required:!0,message:"产品代号不能为空",trigger:"blur"}],productMethod:[{required:!0,message:"请选择产品方法",trigger:"blur"}],chargesMethod:[{required:!0,message:"请选择收费方法",trigger:"blur"}],version:[{required:!0,message:"版本不能为空",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],price:[{required:!0,message:"价格不能为空",trigger:"blur"},{type:"number",message:"价格必须为数字",trigger:"blur"}],orderNum:[{required:!0,message:"排序号不能为空",trigger:"blur"}],argument:[{required:!0,message:"请至少创建一个参数",trigger:"blur"}]},methodsList:[],typeList:[{label:"快捷产品",value:1},{label:"联合建模产品",value:2}],statusList:[{label:"无效",value:0},{label:"有效",value:1}],configList:[],checkedConfig:[],argumentsList:[],drawerVisible:!1,versionVisible:!1,switchValue:!1}},methods:{handleMethodsList:function(){var e=this;this.$api.productManager.getProductMethods().then((function(t){e.methodsList=t}))},handleAddProduct:function(){var e=this;this.drawerVisible=!0,this.$nextTick((function(){l=Object(c["d"])(e.productForm)}))},handleEditProduct:function(e){var t=this,r=e.id,o=e.chargesMethod,s=e.orderNum,i=e.price,a=e.productCode,n=e.productName,u=e.status,d=e.type,p=e.version,m=e.productMethod.split(","),h=e.argument.split(",");this.curProductId=r,this.$set(this,"productForm",{productName:n,productCode:a,productMethod:m,chargesMethod:o,version:p,type:d,price:i,status:u,orderNum:s,argument:h}),this.drawerVisible=!0,this.$nextTick((function(){l=Object(c["d"])(t.productForm)}))},handleSaveProduct:function(){var e=this;this.$refs.productForm.validate((function(t){function r(e){e.rel?(this.$message({type:"success",message:"".concat(-1===this.curProductId?"新增":"编辑","产品成功")}),this.drawerVisible=!1,this.searchParams()):this.$message({type:"error",message:e.message||"保存失败"})}if(!t)return!1;var o=Object(c["d"])(e.productForm);o.argument=o.argument.join(","),o.productMethod=o.productMethod.join(","),e.curProductId>=0?e.$api.productManager.editProduct(o,e.curProductId).then(r.bind(e)):e.$api.productManager.addProduct(o).then(r.bind(e))}))},handleThirdConfig:function(e){var t=this;this.curProductCode=e,this.$api.productManager.getThirdConfig({productCode:e}).then((function(e){t.configList=e||[],t.checkedConfig=e.filter((function(e){return 1===e.selected})).map((function(e){return e.id})),t.configDialogVisible=!0}))},handleSaveConfig:function(){var e=this;this.$api.productManager.saveThirdConfig({productCode:this.curProductCode,methodIds:this.checkedConfig}).then((function(t){t.rel?(e.$message({type:"success",message:"第三方配置绑定成功!"}),e.configDialogVisible=!1,e.searchParams()):e.$message({type:"error",message:"第三方配置绑定失败!"})}))},handleDialogClosed:function(e){1===e?(this.curProductId=-1,this.$refs.productForm.clearValidate(),this.$set(this,"productForm",{productName:"",productCode:"",productMethod:[],chargesMethod:"",version:"",type:"",price:"",status:1,orderNum:"",argument:[]})):(this.curProductCode="-1",this.checkedConfig=[])},searchParams:function(){this.$refs.productGrid.searchHandler()},checkDrawerClose:function(e){JSON.stringify(this.productForm)!==JSON.stringify(l)?this.$confirm("您已进行过编辑，是否放弃本次修改?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e()})).catch((function(){})):e()},handleVersionManager:function(e){this.curProductCode=e,this.versionVisible=!0},toggleSwitch:function(e,t){var r=this;t.preventDefault();var o=Object(c["d"])(e);o.status=1===o.status?0:1,this.$api.productManager.editProduct(o,e.id).then((function(t){t.rel?(r.$message({type:"success",message:"状态切换成功"}),e.status=1===e.status?0:1):r.$message({type:"error",message:"状态切换失败"})}))}},mounted:function(){this.handleMethodsList()}},d=u,p=(r("c975"),r("2877")),m=Object(p["a"])(d,o,s,!1,null,"7cf047b7",null);t["default"]=m.exports},"86f2":function(e,t,r){"use strict";var o=r("58d3"),s=r.n(o);s.a},c975:function(e,t,r){"use strict";var o=r("45f4"),s=r.n(o);s.a},f1ba:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"handle-options"},[r("el-button",{staticClass:"back-button",attrs:{plain:"",icon:"el-icon-arrow-left",size:"small"},on:{click:e.backToProductManager}},[e._v("返回")]),r("el-button",{attrs:{type:"success",size:"small",plain:"",icon:"el-icon-plus"},on:{click:e.handleAddVersion}},[e._v("新增")])],1),r("grid-unit",{ref:"versionGrid",attrs:{formOptions:e.formOptions,reqMethod:e.$api.productManager.getProductVersionList,autoLoad:!1,columns:e.colModels},scopedSlots:e._u([{key:"versionStatus",fn:function(t){return[r("toggle-button",{attrs:{sync:!0,value:1===t.row.status,labels:{checked:"开",unchecked:"关"},color:"#67C23A"},nativeOn:{click:function(r){return e.toggleSwitch(t.row,r)}}})]}},{key:"handle",fn:function(t){return[r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(r){return e.handleEditVersion(t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(r){return e.handleDeleteVersion(t.row)}}},[e._v("删除")])]}}])}),r("el-dialog",{attrs:{title:-1===e.curVersionId?"新增版本":"编辑版本",visible:e.versionDialogVisible,"append-to-body":"",width:"400px"},on:{"update:visible":function(t){e.versionDialogVisible=t},closed:e.handleDialogClosed}},[r("el-form",{ref:"versionForm",staticClass:"versionForm",attrs:{model:e.versionForm,rules:e.versionFormRules,"label-width":"90px"}},[r("el-form-item",{attrs:{label:"产品代号",prop:"productCode"}},[r("el-input",{attrs:{disabled:""},model:{value:e.versionForm.productCode,callback:function(t){e.$set(e.versionForm,"productCode",t)},expression:"versionForm.productCode"}})],1),r("el-form-item",{attrs:{label:"版本",prop:"version"}},[r("el-input",{model:{value:e.versionForm.version,callback:function(t){e.$set(e.versionForm,"version",t)},expression:"versionForm.version"}})],1),r("el-form-item",{attrs:{label:"评分卡",prop:"scorecard"}},[r("el-select",{staticStyle:{width:"100%"},model:{value:e.versionForm.scorecard,callback:function(t){e.$set(e.versionForm,"scorecard",t)},expression:"versionForm.scorecard"}},e._l(e.scoreCardList,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:"规则组",prop:"ruleGroup"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:""},model:{value:e.versionForm.ruleGroup,callback:function(t){e.$set(e.versionForm,"ruleGroup",t)},expression:"versionForm.ruleGroup"}},e._l(e.ruleGroupList,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.versionDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveVersion}},[e._v("确 定")])],1)],1)],1)},s=[],i=(r("28a5"),r("e1ca")),a=r("ed08"),n={name:"versionManager",props:{visible:{type:Boolean,default:!1},productCode:{type:String,default:"-1"}},components:{GridUnit:i["a"]},data:function(){return{colModels:[{prop:"productCode",label:"产品代号"},{prop:"ruleGroup",label:"规则组"},{prop:"scorecard",label:"评分卡"},{prop:"version",label:"版本"},{label:"状态",slotName:"versionStatus"},{prop:"crtTime",label:"创建时间"},{prop:"updTime",label:"更新时间"},{label:"操作",slotName:"handle",fixed:"right",width:150}],formOptions:{productCode:""},ruleGroupList:[],scoreCardList:[],versionDialogVisible:!1,versionForm:{productCode:"",scorecard:"",version:"",ruleGroup:[],status:1},versionFormRules:{productCode:[{required:!0,message:"产品代号不能为空",trigger:"blur"}],scorecard:[{required:!0,message:"评分卡不能为空",trigger:"blur"}],version:[{required:!0,message:"版本不能为空",trigger:"blur"}],ruleGroup:[{required:!0,message:"规则组不能为空",trigger:"blur"}]},curVersionId:-1}},watch:{visible:function(e){var t=this;e&&(this.formOptions.productCode=this.productCode,this.versionForm.productCode=this.productCode,this.$nextTick((function(){t.searchParams(),t.handleRuleGroupList(),t.handleScoreCardList()})))}},methods:{handleAddVersion:function(){this.versionDialogVisible=!0},handleEditVersion:function(e){var t=e.version,r=e.productCode,o=e.ruleGroup,s=e.status,i=e.scorecard,a=e.id;this.curVersionId=a,this.$set(this,"versionForm",{version:t,productCode:r,ruleGroup:o.split(","),status:s,scorecard:i}),this.versionDialogVisible=!0},handleDeleteVersion:function(e){var t=this;this.$confirm("确定删除此版本吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$api.productManager.deleteVersion(e.id).then((function(e){t.$message({type:e.rel?"success":"error",message:e.message||(e.rel?"删除成功":"删除失败")}),e.rel&&t.searchParams()}))})).catch((function(){return!1}))},searchParams:function(){this.$refs.versionGrid.searchHandler()},backToProductManager:function(){this.$emit("update:visible",!1),this.$emit("update:productCode","-1")},handleRuleGroupList:function(){var e=this;this.$api.productManager.getRuleGroupList().then((function(t){e.ruleGroupList=t||[]}))},handleScoreCardList:function(){var e=this;this.$api.productManager.getScoreCardList().then((function(t){e.scoreCardList=t||[]}))},handleSaveVersion:function(){var e=this;this.$refs.versionForm.validate((function(t){if(t){var r=-1===e.curVersionId,o=e.$api.productManager[r?"addVersion":"editVersion"],s=Object(a["d"])(e.versionForm);s.ruleGroup=s.ruleGroup.join(","),o(s,r?void 0:e.curVersionId).then((function(t){t.rel?(e.$message({type:"success",message:"".concat(r?"新增":"编辑","版本成功")}),e.versionDialogVisible=!1,e.searchParams()):e.$message({type:"error",message:t.message||"".concat(r?"新增":"编辑","版本失败")})}))}}))},handleDialogClosed:function(){this.curVersionId=-1,this.$refs.versionForm.clearValidate(),this.$set(this,"versionForm",{productCode:this.productCode,scorecard:"",version:"",ruleGroup:[],status:1})},toggleSwitch:function(e,t){var r=this;t.preventDefault();var o=Object(a["d"])(e);o.status=1===o.status?0:1,this.$api.productManager.editVersion(o,e.id).then((function(t){t.rel?(r.$message({type:"success",message:"状态切换成功"}),e.status=1===e.status?0:1):r.$message({type:"error",message:"状态切换失败"})}))}}},c=n,l=(r("86f2"),r("2877")),u=Object(l["a"])(c,o,s,!1,null,"7ea366c6",null);t["default"]=u.exports}}]);